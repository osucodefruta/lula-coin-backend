<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lula Coin Miner</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    :root {
      --primary-color: #ff3b3b;
      --secondary-color: #2e008a;
      --tertiary-color: #0a0e2a;
      --text-color: #e0e0e0;
      --dark-gray: #1a1a1a;
      --medium-gray: #333;
      --light-gray: #555;
      --border-color: rgba(255, 59, 59, 0.3);
      --glow-color: rgba(255, 59, 59, 0.6);
    }

    body {
      font-family: 'Share Tech Mono', monospace;
      background-color: var(--tertiary-color);
      color: var(--text-color);
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .login-container {
      width: 100%;
      max-width: 400px;
      padding: 2rem;
      background-color: var(--dark-gray);
      border: 2px solid var(--border-color);
      border-radius: 10px;
      box-shadow: 0 0 20px var(--glow-color);
    }

    h1 {
      color: var(--primary-color);
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 10px var(--glow-color);
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-color);
    }

    input {
      width: 100%;
      padding: 0.8rem;
      background-color: var(--medium-gray);
      border: 1px solid var(--border-color);
      border-radius: 5px;
      color: var(--text-color);
      font-family: 'Share Tech Mono', monospace;
    }

    button {
      width: 100%;
      padding: 1rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
    }

    button:hover {
      background-color: #ff6666;
      transform: translateY(-2px);
    }

    .switch-form {
      text-align: center;
      margin-top: 1.5rem;
    }

    .switch-form a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .switch-form a:hover {
      color: #ff6666;
      text-decoration: underline;
    }

    .overlay-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 1.1em;
      z-index: 1000;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .overlay-message.show {
      opacity: 1;
      visibility: visible;
    }

    .overlay-message.success {
      background-color: rgba(40, 167, 69, 0.8);
    }

    .overlay-message.error {
      background-color: rgba(220, 53, 69, 0.8);
    }

    .overlay-message.info {
      background-color: rgba(0, 123, 255, 0.8);
    }

    #gamePage {
      display: none;
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <!-- Página de Login/Registro -->
  <div id="loginPage">
    <div class="login-container">
      <h1>Lula Coin Miner</h1>
      
      <form id="loginForm">
        <h2>Login</h2>
        <div class="form-group">
          <label for="loginUsername">Nome de Usuário:</label>
          <input type="text" id="loginUsername" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">Senha:</label>
          <input type="password" id="loginPassword" required>
        </div>
        <button type="submit">Entrar</button>
        <div class="switch-form">
          <a href="#" id="showRegisterLink">Não tem uma conta? Registre-se</a>
        </div>
      </form>

      <form id="registerForm" style="display: none;">
        <h2>Registro</h2>
        <div class="form-group">
          <label for="registerUsername">Nome de Usuário:</label>
          <input type="text" id="registerUsername" required>
        </div>
        <div class="form-group">
          <label for="registerPassword">Senha:</label>
          <input type="password" id="registerPassword" required>
        </div>
        <button type="submit">Registrar</button>
        <div class="switch-form">
          <a href="#" id="showLoginLink">Já tem uma conta? Faça login</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Página do Jogo (inicialmente oculta) -->
  <div id="gamePage">
    <!-- O conteúdo do jogo será carregado aqui via JavaScript -->
  </div>

  <div class="overlay-message" id="overlayMessage"></div>

  <script>
    // Configurações
    const API_BASE_URL = 'https://lula-coin-backend.onrender.com'; // Atualize para sua URL real
    const AUTH_ENDPOINTS = {
      register: '/api/auth/register',
      login: '/api/auth/login'
    };

    // Elementos do DOM
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const showRegisterLink = document.getElementById('showRegisterLink');
    const showLoginLink = document.getElementById('showLoginLink');
    const overlayMessage = document.getElementById('overlayMessage');
    const loginPage = document.getElementById('loginPage');
    const gamePage = document.getElementById('gamePage');

    // Mostrar mensagem na tela
    function showMessage(message, type = 'info', duration = 3000) {
      overlayMessage.textContent = message;
      overlayMessage.className = `overlay-message ${type} show`;
      
      setTimeout(() => {
        overlayMessage.className = 'overlay-message';
      }, duration);
    }

    // Função para fazer requisições à API
    async function makeRequest(url, method, body = null) {
      const headers = {
        'Content-Type': 'application/json'
      };

      try {
        const response = await fetch(`${API_BASE_URL}${url}`, {
          method,
          headers,
          body: body ? JSON.stringify(body) : null
        });

        // Verifica se a resposta é JSON válido
        const text = await response.text();
        let data;
        try {
          data = text ? JSON.parse(text) : {};
        } catch (e) {
          console.error('Resposta do servidor não é JSON válido:', text);
          throw new Error('Resposta do servidor inválida');
        }

        if (!response.ok) {
          throw new Error(data.message || 'Erro na requisição');
        }

        return data;
      } catch (error) {
        console.error(`Erro na requisição ${method} ${url}:`, error);
        throw error;
      }
    }

    // Registrar novo usuário
    async function registerUser(username, password) {
      try {
        showMessage('Registrando...', 'info');
        
        const data = await makeRequest(AUTH_ENDPOINTS.register, 'POST', {
          username,
          password
        });

        showMessage('Registro bem-sucedido! Faça login.', 'success');
        showLoginForm();
      } catch (error) {
        showMessage(error.message || 'Erro ao registrar. Tente outro nome de usuário.', 'error');
      }
    }

    // Login do usuário
    async function loginUser(username, password) {
      try {
        showMessage('Fazendo login...', 'info');
        
        const data = await makeRequest(AUTH_ENDPOINTS.login, 'POST', {
          username,
          password
        });

        // Salva o token e username no localStorage
        localStorage.setItem('token', data.token);
        localStorage.setItem('username', username);

        showMessage('Login bem-sucedido! Carregando jogo...', 'success');
        
        // Esconde a página de login e carrega o jogo
        setTimeout(() => {
          loginPage.style.display = 'none';
          gamePage.style.display = 'block';
          loadGame();
        }, 1500);
      } catch (error) {
        showMessage(error.message || 'Erro ao fazer login. Verifique suas credenciais.', 'error');
      }
    }

    // Carregar o jogo após login
    function loadGame() {
      // Aqui você pode carregar o conteúdo do jogo dinamicamente
      // ou incluir o HTML do jogo diretamente
      gamePage.innerHTML = `
        <div style="padding: 20px; text-align: center;">
          <h2>Bem-vindo ao Lula Coin Miner, ${localStorage.getItem('username')}!</h2>
          <p>Jogo carregado com sucesso!</p>
          <button id="logoutButton" style="margin-top: 20px;">Sair</button>
        </div>
      `;

      // Adiciona evento ao botão de logout
      document.getElementById('logoutButton').addEventListener('click', logout);
    }

    // Logout do usuário
    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('username');
      gamePage.style.display = 'none';
      gamePage.innerHTML = '';
      loginPage.style.display = 'flex';
      showMessage('Você foi desconectado', 'info');
    }

    // Mostrar formulário de login
    function showLoginForm() {
      loginForm.style.display = 'block';
      registerForm.style.display = 'none';
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
    }

    // Mostrar formulário de registro
    function showRegisterForm() {
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
      document.getElementById('registerUsername').value = '';
      document.getElementById('registerPassword').value = '';
    }

    // Event Listeners
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value.trim();
      
      if (username && password) {
        loginUser(username, password);
      } else {
        showMessage('Preencha todos os campos', 'error');
      }
    });

    registerForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value.trim();
      
      if (username && password) {
        registerUser(username, password);
      } else {
        showMessage('Preencha todos os campos', 'error');
      }
    });

    showRegisterLink.addEventListener('click', (e) => {
      e.preventDefault();
      showRegisterForm();
    });

    showLoginLink.addEventListener('click', (e) => {
      e.preventDefault();
      showLoginForm();
    });

    // Verifica se o usuário já está logado ao carregar a página
    window.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      const username = localStorage.getItem('username');
      
      if (token && username) {
        loginPage.style.display = 'none';
        gamePage.style.display = 'block';
        loadGame();
      }
    });
  </script>
</body>
</html>
